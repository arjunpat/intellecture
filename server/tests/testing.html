<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-auth.js"></script>


<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCcVmiE6jRuOK-XrD2TeGHVAhRUamq80jU",
    authDomain: "intellecture-6b3e6.firebaseapp.com",
    databaseURL: "https://intellecture-6b3e6.firebaseio.com",
    projectId: "intellecture-6b3e6",
    storageBucket: "intellecture-6b3e6.appspot.com",
    messagingSenderId: "462381253872",
    appId: "1:462381253872:web:fc0f440c35a1c920026e35"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  

  let token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1ODc1MjU0NzQwMTgsInVpZCI6InJVSnlQMzE3aXVaRXJObGhybm55bjhlVDd1WTIifQ.ufVoZHvzopoevhVwBAklgXvUNG8Bn6Nmbg2M5goMhm4";

  let postStuff;

  function genPostStuff() {
    postStuff = {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
      }
    }
  }
  genPostStuff();

  function signIn() {
    let provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider).then(res => {
      fetch(hostp + '/auth/login', {
        ...postStuff,
        body: JSON.stringify({
          firebase_token: res.user.xa
        })
      }).then(res => res.json()).then(res => {
        token = res.data.token;
        genPostStuff();
      });
    });
  }

</script>

<script>
  let host = 'api.intellecture.app';
  let hostp = 'https://api.intellecture.app';
  function createClass(name) {
    fetch(hostp + '/class/create', {
      ...postStuff,
      body: JSON.stringify({
        name
      })
    });
  }

  function getMyClasses() {
    fetch(hostp + '/classes/mine', {
      ...postStuff,
      method: 'GET'
    }).then(res => res.json()).then(res => console.log(res.data));
  }

  function createLecture(class_uid, name) {
    fetch(hostp + '/lectures/create', {
      ...postStuff,
      body: JSON.stringify({
        class_uid,
        name
      })
    });
  }

  function lectureExists(lecture_uid) {
    fetch(hostp + '/lectures/exists/' + lecture_uid, {
      ...postStuff,
      method: 'GET'
    }).then(res => res.json()).then(res => {
      console.log(res.data);
    });
  }

  function getMyLectures(class_uid) {
    fetch(hostp + '/lectures/get/' + class_uid, {
      ...postStuff,
      method: 'GET'
    }).then(res => res.json()).then(res => console.log(res.data));
  }

  let ws
  function wsStart(lecture_id) {
    ws = new WebSocket(`ws://${host}/lecture/live/${lecture_id}?access_token=` + encodeURIComponent(token));
    ws.onmessage = msg => {
      ws.onjson(JSON.parse(msg.data));
    }

    ws.onjson = obj => {
      console.log(obj);
    }

    ws.json = obj => ws.send(JSON.stringify(obj));
  }
</script>
