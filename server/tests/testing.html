<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-auth.js"></script>


<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyCcVmiE6jRuOK-XrD2TeGHVAhRUamq80jU",
    authDomain: "intellecture-6b3e6.firebaseapp.com",
    databaseURL: "https://intellecture-6b3e6.firebaseio.com",
    projectId: "intellecture-6b3e6",
    storageBucket: "intellecture-6b3e6.appspot.com",
    messagingSenderId: "462381253872",
    appId: "1:462381253872:web:fc0f440c35a1c920026e35"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  let postStuff;

  function genPostStuff() {
    postStuff = {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      credentials: 'include'
    }
  }
  genPostStuff();

  function signIn() {
    let provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider).then(res => {
      fetch(hostp + '/auth/signin', {
        ...postStuff,
        body: JSON.stringify({
          firebase_token: res.user.xa
        })
      }).then(res => res.json()).then(res => {
        console.log(res.data.token);
        token = res.data.token;
        genPostStuff();
      });
    });
  }

  async function getProfile() {
    let res = await fetch(hostp + '/auth/profile', {
      ...postStuff,
      method: 'GET'
    });
    res = await res.json();
    console.log(res.data);
  }

  function logout() {
    fetch(hostp + '/auth/signout', {
      ...postStuff,
      method: 'GET'
    });
  }

</script>

<script>
  // let host = 'api.intellecture.app';
  // let hostp = 'https://api.intellecture.app';
  let hostp = 'http://localhost:8080';
  function createClass(name) {
    fetch(hostp + '/classes/create', {
      ...postStuff,
      body: JSON.stringify({
        name
      })
    });
  }

  function getMyClasses() {
    fetch(hostp + '/classes/mine', {
      ...postStuff,
      method: 'GET'
    }).then(res => res.json()).then(res => console.log(res.data));
  }

  function createLecture(class_uid, name) {
    fetch(hostp + '/lectures/create', {
      ...postStuff,
      body: JSON.stringify({
        class_uid,
        name
      })
    });
  }

  function lectureExists(lecture_uid) {
    fetch(hostp + '/lectures/exists/' + lecture_uid, {
      ...postStuff,
      method: 'GET'
    }).then(res => res.json()).then(res => {
      console.log(res.data);
    });
  }

  function getMyLectures(class_uid) {
    fetch(hostp + '/lectures/get/' + class_uid, {
      ...postStuff,
      method: 'GET'
    }).then(res => res.json()).then(res => console.log(res.data));
  }

  function createFeedback(stars) {
    fetch(hostp + '/feedback/create', {
      ...postStuff,
      body: JSON.stringify({
        stars: 4
      })
    }).then(res => res.json()).then(res => console.log(res));
  }

  function updateFeedback(id, stars, comments, tech_comments, diff_stars, helpful_stars) {
    fetch(hostp + '/feedback/update', {
      ...postStuff,
      body: JSON.stringify({
        id,
        stars,
        comments,
        tech_comments,
        diff_stars,
        helpful_stars
      })
    }).then(res => res.json()).then(res => console.log(res));
  }

  function getStudents(lecture_uid) {
    fetch(hostp + '/analytics/lecture/students/' + lecture_uid, {
      ...postStuff,
      method: 'GET'
    }).then(res => res.json()).then(res => console.log(res));
  }

  function getActiveLectures() {
    fetch(hostp + '/admin/active-lectures', {
      ...postStuff,
      method: 'GET'
    }).then(res => res.json()).then(res => console.log(res));
  }
</script>
